!function(t,o){"use strict";"function"==typeof define&&define.amd?define("RowSorter",o):"object"==typeof exports?module.exports=o():t.RowSorter=o()}(this,function(){"use strict";function t(h,u){if(!(this instanceof t))return new t(h,u);if("string"==typeof h&&(h=a(h)),l(h,"table")===!1)throw new Error("Table not found.");return h[k]instanceof t?h[k]:(this._options=v(S,u),this._table=h,this._tbody=h,this._rows=[],this._lastY=!1,this._draggingRow=null,this._firstTouch=!0,this._lastSort=null,this._ended=!0,this._mousedown=m(o,this),this._mousemove=m(i,this),this._mouseup=m(e,this),this._touchstart=m(s,this),this._touchmove=m(n,this),this._touchend=m(r,this),this._touchId=null,this._table[k]=this,void this.init())}function o(t){return t=t||window.event,this._start(t.target||t.srcElement,t.clientY)?(t.preventDefault?t.preventDefault():t.returnValue=!1,!1):!0}function s(t){if(1===t.touches.length){var o=t.touches[0],s=document.elementFromPoint(o.clientX,o.clientY);if(this._touchId=o.identifier,this._start(s,o.clientY))return t.preventDefault?t.preventDefault():t.returnValue=!1,!1}return!0}function i(t){return t=t||window.event,this._move(t.target||t.srcElement,t.clientY),!0}function n(t){if(1===t.touches.length){var o=t.touches[0],s=document.elementFromPoint(o.clientX,o.clientY);this._touchId===o.identifier&&this._move(s,o.clientY)}return!0}function e(){this._end()}function r(t){t.changedTouches.length>0&&this._touchId===t.changedTouches[0].identifier&&this._end()}function h(o){return o instanceof t?o:("string"==typeof o&&(o=a(o)),l(o,"table")&&k in o&&o[k]instanceof t?o[k]:null)}function a(t){var o=b(document,t);return o.length>0&&l(o[0],"table")?o[0]:null}function l(t,o){return t&&"object"==typeof t&&"nodeName"in t&&t.nodeName===o.toUpperCase()}function u(t,o,s){var i=t.parentNode;1===s?o.nextSibling?i.insertBefore(t,o.nextSibling):i.appendChild(t):-1===s&&i.insertBefore(t,o)}function _(t,o){for(var s=t.rows,i=s.length,n=0;i>n;n++)if(o===s[n])return n;return-1}function c(t,o,s){t.attachEvent?t.attachEvent("on"+o,s):t.addEventListener(o,s,!1)}function d(t,o,s){t.detachEvent?t.detachEvent("on"+o,s):t.removeEventListener(o,s,!1)}function p(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function f(t,o){if(o=p(o),""===o)return!1;if(-1!==o.indexOf(" ")){for(var s=o.replace(/\s+/g," ").split(" "),i=0,n=s.length;n>i;i++)if(f(t,s[i])===!1)return!1;return!0}return t.classList?!!t.classList.contains(o):!!t.className.match(new RegExp("(\\s|^)"+o+"(\\s|$)"))}function g(t,o){if(o=p(o),""!==o)if(-1===o.indexOf(" "))f(t,o)===!1&&(t.classList?t.classList.add(o):t.className+=" "+o);else for(var s=o.replace(/\s+/g," ").split(" "),i=0,n=s.length;n>i;i++)g(t,s[i])}function w(t,o){if(o=p(o),""!==o)if(-1===o.indexOf(" "))f(t,o)&&(t.classList?t.classList.remove(o):t.className=t.className.replace(new RegExp("(\\s|^)"+o+"(\\s|$)")," "));else for(var s=o.replace(/\s+/g," ").split(" "),i=0,n=s.length;n>i;i++)w(t,s[i])}function m(t,o){return Function.prototype.bind?t.bind(o):function(){t.apply(o,D.slice.call(arguments))}}function v(t,o){if(x)return x.extend({},t,o);var s,i={};for(s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);if(o&&"[object Object]"===Object.prototype.toString.call(o))for(s in o)o.hasOwnProperty(s)&&(i[s]=o[s]);return i}function b(t,o){return x?x.makeArray(x(t).find(o)):t.querySelectorAll(o)}function y(t,o){var s=1,i=20,n=t;for(o=o.toLowerCase();n.tagName&&n.tagName.toLowerCase()!==o;){if(s>i||!n.parentNode)return null;n=n.parentNode,s++}return n}function R(t,o){if(D.indexOf)return D.indexOf.call(t,o);for(var s=0,i=t.length;i>s;s++)if(o===t[s])return s;return-1}var x=!1,D=Array.prototype,E=!!("ontouchstart"in document),k="data-rowsorter",S={handler:null,tbody:!0,tableClass:"sorting-table",dragClass:"sorting-row",stickTopRows:0,stickBottomRows:0,onDragStart:null,onDragEnd:null,onDrop:null};return t.prototype.init=function(){if(this._options.tbody){var t=this._table.getElementsByTagName("tbody");t.length>0&&(this._tbody=t[0])}if("function"!=typeof this._options.onDragStart&&(this._options.onDragStart=null),"function"!=typeof this._options.onDrop&&(this._options.onDrop=null),"function"!=typeof this._options.onDragEnd&&(this._options.onDragEnd=null),("number"!=typeof this._options.stickTopRows||this._options.stickTopRows<0)&&(this._options.stickTopRows=0),("number"!=typeof this._options.stickBottomRows||this._options.stickBottomRows<0)&&(this._options.stickBottomRows=0),c(this._table,"mousedown",this._mousedown),c(document,"mouseup",this._mouseup),E&&(c(this._table,"touchstart",this._touchstart),c(this._table,"touchend",this._touchend)),"onselectstart"in document){var o=this;c(document,"selectstart",function(t){var s=t||window.event;return null!==o._draggingRow?(s.preventDefault?s.preventDefault():s.returnValue=!1,!1):void 0})}},t.prototype._start=function(t,o){if(this._draggingRow&&this._end(),this._rows=this._tbody.rows,this._rows.length<2)return!1;if(this._options.handler){var s=b(this._table,this._options.handler);if(!s||-1===R(s,t))return!1}var i=y(t,"tr"),n=_(this._tbody,i);return-1===n||this._options.stickTopRows>0&&n<this._options.stickTopRows||this._options.stickBottomRows>0&&n>=this._rows.length-this._options.stickBottomRows?!1:(this._draggingRow=i,this._options.tableClass&&g(this._table,this._options.tableClass),this._options.dragClass&&g(this._draggingRow,this._options.dragClass),this._oldIndex=n,this._options.onDragStart&&this._options.onDragStart(this._tbody,this._draggingRow,this._oldIndex),this._lastY=o,this._ended=!1,c(this._table,"mousemove",this._mousemove),E&&c(this._table,"touchmove",this._touchmove),!0)},t.prototype._move=function(t,o){if(this._draggingRow){var s=o>this._lastY?1:o<this._lastY?-1:0;if(0!==s){var i=y(t,"tr");if(i&&i!==this._draggingRow&&-1!==R(this._rows,i)){var n=!0;if(this._options.stickTopRows>0||this._options.stickBottomRows>0){var e=_(this._tbody,i);(this._options.stickTopRows>0&&e<this._options.stickTopRows||this._options.stickBottomRows>0&&e>=this._rows.length-this._options.stickBottomRows)&&(n=!1)}n&&u(this._draggingRow,i,s),this._lastY=o}}}},t.prototype._end=function(){if(!this._draggingRow)return!0;this._options.tableClass&&w(this._table,this._options.tableClass),this._options.dragClass&&w(this._draggingRow,this._options.dragClass);var t=_(this._tbody,this._draggingRow);if(t!==this._oldIndex){var o=this._lastSort;this._lastSort={previous:o,newIndex:t,oldIndex:this._oldIndex},this._options.onDrop&&this._options.onDrop(this._tbody,this._draggingRow,t,this._oldIndex)}else this._options.onDragEnd&&this._options.onDragEnd(this._tbody,this._draggingRow,this._oldIndex);this._draggingRow=null,this._lastY=!1,this._touchId=null,this._ended=!0,d(this._table,"mousemove",this._mousemove),E&&d(this._table,"touchmove",this._touchmove)},t.prototype.revert=function(){if(null!==this._lastSort){var t=this._lastSort,o=t.oldIndex,s=t.newIndex,i=this._tbody.rows,n=i.length-1;i.length>1&&(n>o?this._tbody.insertBefore(i[s],i[o+(s>o?0:1)]):this._tbody.appendChild(i[s])),this._lastSort=t.previous}},t.prototype.undo=t.prototype.revert,t.prototype.destroy=function(){this._table[k]=null,this._ended===!1&&this._end(),d(this._table,"mousedown",this._mousedown),d(document,"mouseup",this._mouseup),E&&(d(this._table,"touchstart",this._touchstart),d(this._table,"touchend",this._touchend))},t.revert=function(t,o){var s=h(t);if(null===s&&o===!1)throw new Error("Table not found.");s&&s.revert()},t.undo=t.revert,t.destroy=function(t,o){var s=h(t);if(null===s&&o===!1)throw new Error("Table not found.");s&&s.destroy()},t});