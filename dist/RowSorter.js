!function(t,o){"use strict";"function"==typeof define&&define.amd?define("RowSorter",o):"object"==typeof exports?module.exports=o():t.RowSorter=o()}(this,function(){"use strict";function t(h,l){if(!(this instanceof t))return new t(h,l);if("string"==typeof h&&(h=a(h)),u(h,"table")===!1)throw new Error("Table not found.");return h[k]instanceof t?h[k]:(this._options=v(S,l),this._table=h,this._tbody=h,this._rows=[],this._lastY=!1,this._draggingRow=null,this._firstTouch=!0,this._lastSort=null,this._ended=!0,this._mousedown=m(o,this),this._mousemove=m(s,this),this._mouseup=m(e,this),this._touchstart=m(n,this),this._touchmove=m(i,this),this._touchend=m(r,this),this._touchId=null,this._table[k]=this,void this.init())}function o(t){return t=t||window.event,this._start(t.target||t.srcElement,t.clientY)?(t.preventDefault?t.preventDefault():t.returnValue=!1,!1):!0}function n(t){if(1===t.touches.length){var o=t.touches[0],n=document.elementFromPoint(o.clientX,o.clientY);if(this._touchId=o.identifier,this._start(n,o.clientY))return t.preventDefault?t.preventDefault():t.returnValue=!1,!1}return!0}function s(t){return t=t||window.event,this._move(t.target||t.srcElement,t.clientY),!0}function i(t){if(1===t.touches.length){var o=t.touches[0],n=document.elementFromPoint(o.clientX,o.clientY);this._touchId===o.identifier&&this._move(n,o.clientY)}return!0}function e(){this._end()}function r(t){t.changedTouches.length>0&&this._touchId===t.changedTouches[0].identifier&&this._end()}function h(o){return o instanceof t?o:("string"==typeof o&&(o=a(o)),u(o,"table")&&k in o&&o[k]instanceof t?o[k]:null)}function a(t){var o=b(document,t);return o.length>0&&u(o[0],"table")?o[0]:null}function u(t,o){return t&&"object"==typeof t&&"nodeName"in t&&t.nodeName===o.toUpperCase()}function l(t,o,n){var s=t.parentNode;1===n?o.nextSibling?s.insertBefore(t,o.nextSibling):s.appendChild(t):-1===n&&s.insertBefore(t,o)}function d(t,o){for(var n=t.rows,s=n.length,i=0;s>i;i++)if(o===n[i])return i;return-1}function c(t,o,n){t.attachEvent?t.attachEvent("on"+o,n):t.addEventListener(o,n,!1)}function _(t,o,n){t.detachEvent?t.detachEvent("on"+o,n):t.removeEventListener(o,n,!1)}function p(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function f(t,o){if(o=p(o),""===o)return!1;if(-1!==o.indexOf(" ")){for(var n=o.replace(/\s+/g," ").split(" "),s=0,i=n.length;i>s;s++)if(f(t,n[s])===!1)return!1;return!0}return t.classList?!!t.classList.contains(o):!!t.className.match(new RegExp("(\\s|^)"+o+"(\\s|$)"))}function g(t,o){if(o=p(o),""!==o)if(-1===o.indexOf(" "))f(t,o)===!1&&(t.classList?t.classList.add(o):t.className+=" "+o);else for(var n=o.replace(/\s+/g," ").split(" "),s=0,i=n.length;i>s;s++)g(t,n[s])}function w(t,o){if(o=p(o),""!==o)if(-1===o.indexOf(" "))f(t,o)&&(t.classList?t.classList.remove(o):t.className=t.className.replace(new RegExp("(\\s|^)"+o+"(\\s|$)")," "));else for(var n=o.replace(/\s+/g," ").split(" "),s=0,i=n.length;i>s;s++)w(t,n[s])}function m(t,o){return Function.prototype.bind?t.bind(o):function(){t.apply(o,D.slice.call(arguments))}}function v(t,o){if(x)return x.extend({},t,o);var n,s={};for(n in t)t.hasOwnProperty(n)&&(s[n]=t[n]);if(o&&"[object Object]"===Object.prototype.toString.call(o))for(n in o)o.hasOwnProperty(n)&&(s[n]=o[n]);return s}function b(t,o){return x?x.makeArray(x(t).find(o)):t.querySelectorAll(o)}function y(t,o){var n=1,s=20,i=t;for(o=o.toLowerCase();i.tagName&&i.tagName.toLowerCase()!==o;){if(n>s||!i.parentNode)return null;i=i.parentNode,n++}return i}function R(t,o){if(D.indexOf)return D.indexOf.call(t,o);for(var n=0,s=t.length;s>n;n++)if(o===t[n])return n;return-1}var x=!1,D=Array.prototype,E=!!("ontouchstart"in document),k="data-rowsorter",S={handler:null,tbody:!0,tableClass:"sorting-table",dragClass:"sorting-row",stickTopRows:0,stickBottomRows:0,onDragStart:null,onDragEnd:null,onDrop:null};return t.prototype.init=function(){if(this._options.tbody){var t=this._table.getElementsByTagName("tbody");t.length>0&&(this._tbody=t[0])}if("function"!=typeof this._options.onDragStart&&(this._options.onDragStart=null),"function"!=typeof this._options.onDrop&&(this._options.onDrop=null),"function"!=typeof this._options.onDragEnd&&(this._options.onDragEnd=null),("number"!=typeof this._options.stickTopRows||this._options.stickTopRows<0)&&(this._options.stickTopRows=0),("number"!=typeof this._options.stickBottomRows||this._options.stickBottomRows<0)&&(this._options.stickBottomRows=0),c(this._table,"mousedown",this._mousedown),c(document,"mouseup",this._mouseup),E&&(c(this._table,"touchstart",this._touchstart),c(this._table,"touchend",this._touchend)),"onselectstart"in document){var o=this;c(document,"selectstart",function(t){var n=t||window.event;return null!==o._draggingRow?(n.preventDefault?n.preventDefault():n.returnValue=!1,!1):void 0})}},t.prototype._start=function(t,o){if(this._draggingRow&&this._end(),this._rows=this._tbody.rows,this._rows.length<2)return!1;if(this._options.handler){var n=b(this._table,this._options.handler);if(!n||-1===R(n,t))return!1}var s=y(t,"tr"),i=d(this._tbody,s);return-1===i||this._options.stickTopRows>0&&i<this._options.stickTopRows||this._options.stickBottomRows>0&&i>=this._rows.length-this._options.stickBottomRows?!1:(this._draggingRow=s,this._options.tableClass&&g(this._table,this._options.tableClass),this._options.dragClass&&g(this._draggingRow,this._options.dragClass),this._oldIndex=i,this._options.onDragStart&&this._options.onDragStart(this._tbody,this._draggingRow,this._oldIndex),this._lastY=o,this._ended=!1,c(this._table,"mousemove",this._mousemove),E&&c(this._table,"touchmove",this._touchmove),!0)},t.prototype._move=function(t,o){if(this._draggingRow){var n=o>this._lastY?1:o<this._lastY?-1:0;if(0!==n){var s=y(t,"tr");if(s&&s!==this._draggingRow&&-1!==R(this._rows,s)){var i=!0;if(this._options.stickTopRows>0||this._options.stickBottomRows>0){var e=d(this._tbody,s);(this._options.stickTopRows>0&&e<this._options.stickTopRows||this._options.stickBottomRows>0&&e>=this._rows.length-this._options.stickBottomRows)&&(i=!1)}i&&l(this._draggingRow,s,n),this._lastY=o}}}},t.prototype._end=function(){if(!this._draggingRow)return!0;this._options.tableClass&&w(this._table,this._options.tableClass),this._options.dragClass&&w(this._draggingRow,this._options.dragClass);var t=d(this._tbody,this._draggingRow);if(t!==this._oldIndex){var o=this._lastSort;this._lastSort={previous:o,newIndex:t,oldIndex:this._oldIndex},this._options.onDrop&&this._options.onDrop(this._tbody,this._draggingRow,t,this._oldIndex)}else this._options.onDragEnd&&this._options.onDragEnd(this._tbody,this._draggingRow,this._oldIndex);this._draggingRow=null,this._lastY=!1,this._touchId=null,this._ended=!0,_(this._table,"mousemove",this._mousemove),E&&_(this._table,"touchmove",this._touchmove)},t.prototype.revert=function(){if(null!==this._lastSort){var t=this._lastSort,o=t.oldIndex,n=t.newIndex,s=this._tbody.rows,i=s.length-1;s.length>1&&(i>o?this._tbody.insertBefore(s[n],s[o+(n>o?0:1)]):this._tbody.appendChild(s[n])),this._lastSort=t.previous}},t.prototype.undo=t.prototype.revert,t.prototype.destroy=function(){this._table[k]=null,this._ended===!1&&this._end(),_(this._table,"mousedown",this._mousedown),_(document,"mouseup",this._mouseup),E&&(_(this._table,"touchstart",this._touchstart),_(this._table,"touchend",this._touchend))},t.revert=function(t,o){var n=h(t);if(null===n&&o===!1)throw new Error("Table not found.");n&&n.revert()},t.undo=t.revert,t.destroy=function(t,o){var n=h(t);if(null===n&&o===!1)throw new Error("Table not found.");n&&n.destroy()},x&&(x.fn.extend({rowSorter:function(o){var n=[];return this.each(function(s,i){n.push(new t(i,o))}),1===n.length?n[0]:n}}),x.rowSorter={undo:t.undo,revert:t.revert,destroy:t.destroy}),t});
